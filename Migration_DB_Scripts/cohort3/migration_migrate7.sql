-- PROCEDURE: migration.migratebits()

-- DROP FUNCTION migration.migratebits();

-- Top level function to trigger migration of Establishments and all sub-elements.
-- RUN with call migration.migratebits();

CREATE OR REPLACE PROCEDURE migration.migrate7(
)
 LANGUAGE plpgsql
AS $BODY$
DECLARE
        Allestbid  REFCURSOR;
        currentestbid record;
Begin 

--truncate migration.errorlog;
--truncate migration.runlog;

OPEN Allestbid  for 
        select id from (
values

(	339	),
(	368	),
(	413	),
(	488	),
(	667	),
(	686	),
(	748	),
(	956	),
(	1043	),
(	1802	),
(	1949	),
(	2074	),
(	2521	),
(	2775	),
(	2846	),
(	3077	),
(	3262	),
(	3726	),
(	3727	),
(	4129	),
(	5971	),
(	6021	),
(	6851	),
(	6871	),
(	7211	),
(	7681	),
(	8052	),
(	8927	),
(	9226	),
(	9331	),
(	9448	),
(	9477	),
(	10287	),
(	10516	),
(	10555	),
(	11751	),
(	11770	),
(	11830	),
(	11955	),
(	12135	),
(	12173	),
(	12249	),
(	12432	),
(	12900	),
(	12905	),
(	12912	),
(	12914	),
(	12916	),
(	12919	),
(	12922	),
(	12926	),
(	13533	),
(	13648	),
(	14955	),
(	15200	),
(	15285	),
(	15499	),
(	15551	),
(	15599	),
(	16436	),
(	16464	),
(	16508	),
(	16631	),
(	16677	),
(	17012	),
(	17024	),
(	17546	),
(	17554	),
(	17643	),
(	17719	),
(	17999	),
(	19175	),
(	19196	),
(	19304	),
(	19350	),
(	19914	),
(	20000	),
(	20102	),
(	20197	),
(	20482	),
(	20641	),
(	20662	),
(	20897	),
(	21650	),
(	21837	),
(	21911	),
(	26022	),
(	27042	),
(	31686	),
(	32022	),
(	32618	),
(	33182	),
(	33762	),
(	37283	),
(	44682	),
(	46724	),
(	49604	),
(	52622	),
(	53122	),
(	53202	),
(	53302	),
(	58402	),
(	58762	),
(	69542	),
(	75122	),
(	78682	),
(	79042	),
(	83142	),
(	86743	),
(	89842	),
(	90751	),
(	91277	),
(	91279	),
(	103122	),
(	105482	),
(	107862	),
(	110962	),
(	115322	),
(	117402	),
(	120303	),
(	120422	),
(	120602	),
(	120622	),
(	120663	),
(	120664	),
(	120682	),
(	120802	),
(	120863	),
(	120864	),
(	120867	),
(	120869	),
(	120871	),
(	120873	),
(	120876	),
(	120877	),
(	120878	),
(	125062	),
(	126242	),
(	126342	),
(	126716	),
(	126719	),
(	126735	),
(	126741	),
(	126752	),
(	126755	),
(	126759	),
(	135509	),
(	136703	),
(	137104	),
(	138047	),
(	138829	),
(	141266	),
(	141509	),
(	142042	),
(	142544	),
(	142688	),
(	143123	),
(	143187	),
(	143228	),
(	143242	),
(	143278	),
(	144116	),
(	144117	),
(	144121	),
(	144309	),
(	144310	),
(	144311	),
(	144316	),
(	144384	),
(	144388	),
(	144391	),
(	144392	),
(	145272	),
(	145947	),
(	145948	),
(	145962	),
(	146233	),
(	146236	),
(	146238	),
(	146239	),
(	146241	),
(	146248	),
(	146251	),
(	146392	),
(	147878	),
(	148088	),
(	148282	),
(	149007	),
(	149009	),
(	149014	),
(	152489	),
(	152522	),
(	152768	),
(	152769	),
(	152770	),
(	152776	),
(	152779	),
(	152782	),
(	152784	),
(	152789	),
(	152884	),
(	154436	),
(	155473	),
(	156022	),
(	156182	),
(	156802	),
(	157198	),
(	157200	),
(	157667	),
(	157805	),
(	158674	),
(	158925	),
(	159419	),
(	159442	),
(	159525	),
(	160372	),
(	161006	),
(	161187	),
(	161200	),
(	161267	),
(	161273	),
(	161279	),
(	161280	),
(	161503	),
(	161620	),
(	161625	),
(	161626	),
(	161632	),
(	161636	),
(	161637	),
(	161644	),
(	161813	),
(	161984	),
(	162126	),
(	162142	),
(	162203	),
(	162243	),
(	162288	),
(	162513	),
(	162514	),
(	162715	),
(	162716	),
(	162717	),
(	162718	),
(	162724	),
(	165074	),
(	165508	),
(	165520	),
(	165802	),
(	166662	),
(	166962	),
(	167242	),
(	168068	),
(	168809	),
(	168912	),
(	168922	),
(	169372	),
(	169478	),
(	169580	),
(	169600	),
(	169998	),
(	170361	),
(	170498	),
(	172380	),
(	172738	),
(	172763	),
(	172986	),
(	173405	),
(	173679	),
(	173760	),
(	173780	),
(	174282	),
(	174284	),
(	174288	),
(	174460	),
(	174562	),
(	174646	),
(	174861	),
(	174974	),
(	174975	),
(	174977	),
(	174979	),
(	174980	),
(	174981	),
(	174982	),
(	174984	),
(	174987	),
(	174989	),
(	174993	),
(	175003	),
(	175009	),
(	175021	),
(	175025	),
(	175026	),
(	175027	),
(	175029	),
(	175030	),
(	175036	),
(	175038	),
(	175041	),
(	175044	),
(	175045	),
(	175049	),
(	175061	),
(	175063	),
(	175064	),
(	175069	),
(	175099	),
(	175342	),
(	175442	),
(	175472	),
(	175475	),
(	175658	),
(	175663	),
(	175664	),
(	175665	),
(	175698	),
(	175699	),
(	175700	),
(	175702	),
(	175703	),
(	176142	),
(	176799	),
(	177218	),
(	178178	),
(	178498	),
(	178738	),
(	178739	),
(	178878	),
(	179358	),
(	179800	),
(	180019	),
(	180358	),
(	180678	),
(	181096	),
(	181100	),
(	181101	),
(	181116	),
(	181155	),
(	181169	),
(	181173	),
(	181418	),
(	181820	),
(	182140	),
(	182398	),
(	182420	),
(	182600	),
(	182701	),
(	182724	),
(	182734	),
(	182748	),
(	183041	),
(	183419	),
(	184098	),
(	184580	),
(	184581	),
(	184582	),
(	184587	),
(	184588	),
(	184589	),
(	184590	),
(	184592	),
(	184593	),
(	184594	),
(	184595	),
(	184596	),
(	184597	),
(	184598	),
(	184599	),
(	184600	),
(	184602	),
(	184603	),
(	184604	),
(	184605	),
(	184606	),
(	184607	),
(	184608	),
(	184609	),
(	184610	),
(	184611	),
(	184612	),
(	184613	),
(	184615	),
(	184617	),
(	184618	),
(	184619	),
(	184620	),
(	184621	),
(	184623	),
(	184624	),
(	184625	),
(	184626	),
(	184630	),
(	184631	),
(	184632	),
(	184634	),
(	184642	),
(	184802	),
(	184960	),
(	185047	),
(	185540	),
(	187441	),
(	187554	),
(	187556	),
(	187570	),
(	187571	),
(	187572	),
(	187899	),
(	188344	),
(	188345	),
(	188346	),
(	188347	),
(	188348	),
(	188349	),
(	188359	),
(	188526	),
(	188527	),
(	188528	),
(	188762	),
(	189499	),
(	189898	),
(	190099	),
(	191221	),
(	191299	),
(	191398	),
(	191558	),
(	192100	),
(	192102	),
(	192103	),
(	192104	),
(	192105	),
(	192106	),
(	192108	),
(	192110	),
(	192111	),
(	192112	),
(	193204	),
(	193207	),
(	194080	),
(	194086	),
(	194097	),
(	194101	),
(	194104	),
(	194105	),
(	194107	),
(	194109	),
(	194118	),
(	194140	),
(	194146	),
(	194147	),
(	194150	),
(	194162	),
(	194164	),
(	194167	),
(	194168	),
(	194573	),
(	195198	),
(	195425	),
(	195920	),
(	195940	),
(	197058	),
(	197579	),
(	197598	),
(	198278	),
(	199141	),
(	199798	),
(	200378	),
(	200389	),
(	200598	),
(	200599	),
(	200684	),
(	200980	),
(	200983	),
(	201443	),
(	201998	),
(	202004	),
(	202006	),
(	202010	),
(	202019	),
(	202103	),
(	202527	),
(	202558	),
(	202638	),
(	202639	),
(	202640	),
(	202698	),
(	202758	),
(	202759	),
(	203365	),
(	203379	),
(	203901	),
(	203956	),
(	204366	),
(	204380	),
(	204381	),
(	206758	),
(	207303	),
(	207364	),
(	207368	),
(	208127	),
(	208246	),
(	208251	),
(	208349	),
(	209327	),
(	209496	),
(	209744	),
(	210924	),
(	211109	),
(	211202	),
(	211283	),
(	211662	),
(	212582	),
(	212788	),
(	212789	),
(	212803	),
(	212804	),
(	213022	),
(	213177	),
(	213179	),
(	213180	),
(	213182	),
(	213183	),
(	213342	),
(	213424	),
(	213425	),
(	213426	),
(	213427	),
(	213442	),
(	213443	),
(	213445	),
(	213446	),
(	213447	),
(	213480	),
(	213642	),
(	213644	),
(	213646	),
(	213649	),
(	214127	),
(	215902	),
(	216122	),
(	216376	),
(	216383	),
(	216418	),
(	217163	),
(	219205	),
(	219246	),
(	219983	),
(	220002	),
(	220543	),
(	220827	),
(	220831	),
(	220842	),
(	220922	),
(	221564	),
(	221824	),
(	222609	),
(	223536	),
(	223539	),
(	223566	),
(	223569	),
(	223570	),
(	223603	),
(	223902	),
(	224142	),
(	224402	),
(	224422	),
(	224423	),
(	224424	),
(	224425	),
(	224428	),
(	224502	),
(	225122	),
(	225202	),
(	225206	),
(	225207	),
(	225208	),
(	225209	),
(	225210	),
(	225211	),
(	225212	),
(	225213	),
(	225214	),
(	225215	),
(	225216	),
(	225217	),
(	225218	),
(	225219	),
(	225220	),
(	225221	),
(	225222	),
(	225262	),
(	225264	),
(	225265	),
(	225266	),
(	225267	),
(	225268	),
(	225269	),
(	225270	),
(	225271	),
(	225272	),
(	225273	),
(	225274	),
(	226485	),
(	226848	),
(	228445	),
(	229285	),
(	229303	),
(	229304	),
(	229305	),
(	229306	),
(	230463	),
(	231102	),
(	231924	),
(	232302	),
(	232603	),
(	232762	),
(	232802	),
(	233303	),
(	233689	),
(	233762	),
(	234262	),
(	235142	),
(	236465	),
(	236466	),
(	236469	),
(	236470	),
(	236473	),
(	236944	),
(	237083	),
(	237383	),
(	237805	),
(	237806	),
(	237807	),
(	237808	),
(	237809	),
(	237810	),
(	237811	),
(	237815	),
(	237823	),
(	237824	),
(	240770	),
(	240771	),
(	240804	),
(	240864	),
(	241083	),
(	241862	),
(	242862	),
(	242942	),
(	243082	),
(	244955	)
)  as t (id) order by 1 asc
;
Loop
Begin
FETCH Allestbid INTO currentestbid;
 EXIT WHEN NOT FOUND;

PERFORM  migration.MigrateEstablishments(currentestbid.id);            
PERFORM  migration.MigrateUsers(currentestbid.id);            
PERFORM  migration.MigrateWorkers(currentestbid.id);            
PERFORM  migration.worker_bulk_training(currentestbid.id);            
PERFORM  migration.worker_bulk_qualifications(currentestbid.id);            

END;
END LOOP;

PERFORM migration.setparents();
COMMIT;

END;
$BODY$;

ALTER PROCEDURE migration.migrate7()
    OWNER TO postgres;
